---
// Image upload component - client-side processing only
---

<div class="flex flex-col gap-3">
  <label
    for="image-upload"
    class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-500 rounded-lg cursor-pointer bg-slate-800 hover:bg-slate-700 transition-colors"
  >
    <div class="flex flex-col items-center justify-center pt-5 pb-6">
      <svg class="w-8 h-8 mb-2 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
      </svg>
      <p class="text-sm text-slate-400">
        <span class="font-semibold">Click to upload</span> or drag and drop
      </p>
      <p class="text-xs text-slate-500">PNG or JPG (square images work best)</p>
    </div>
    <input id="image-upload" type="file" class="hidden" accept="image/png,image/jpeg,image/jpg,image/webp" />
  </label>

  <div id="image-preview-container" class="hidden">
    <img id="image-preview" class="w-full max-w-xs mx-auto rounded-lg shadow-lg" alt="Preview" />
  </div>
</div>

<script>
  import { setImageUrl, $isPlaying } from '../stores/gameStore';

  const fileInput = document.getElementById('image-upload') as HTMLInputElement;
  const previewContainer = document.getElementById('image-preview-container') as HTMLDivElement;
  const preview = document.getElementById('image-preview') as HTMLImageElement;

  fileInput.addEventListener('change', (e) => {
    const target = e.target as HTMLInputElement;
    const file = target.files?.[0];

    if (file) {
      // Create object URL for the image (client-side only, no server upload)
      const url = URL.createObjectURL(file);
      setImageUrl(url);

      // Show preview
      preview.src = url;
      previewContainer.classList.remove('hidden');
    }
  });

  // Handle drag and drop
  const dropZone = document.querySelector('label[for="image-upload"]') as HTMLLabelElement;

  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('border-blue-500', 'bg-slate-700');
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('border-blue-500', 'bg-slate-700');
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('border-blue-500', 'bg-slate-700');

    const file = e.dataTransfer?.files?.[0];
    if (file && file.type.startsWith('image/')) {
      const url = URL.createObjectURL(file);
      setImageUrl(url);
      preview.src = url;
      previewContainer.classList.remove('hidden');
    }
  });
</script>
